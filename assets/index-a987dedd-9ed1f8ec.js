import{b as s,J as p,O as i,s as w,o as y,y as C,a as M,i as v,W as I,Q as k,C as G}from"./index-4eac733d.js";const _=s("video",{id:"videoCamera",autoplay:""},null,-1),j=["src"],L=["width","height"],B=p({__name:"index",setup(O){let d=i(300),r=i(200),u=i(),c=i();const g=i([{id:"",label:"摄像头1"}]),o=i(null),m=i(null),n=i(null);w(()=>{f().then(e=>{e.length&&(g.value=e),u.value=g.value[0].id,h()})});function h(){o.value=document.getElementById("canvasCamera"),m.value=o.value.getContext("2d"),n.value=document.getElementById("videoCamera"),U(u.value)}async function f(){console.log("1111",navigator.mediaDevices),(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)&&(alert("不支持 mediaDevices.enumerateDevices()"),console.log("设备不支持 "));try{return(await navigator.mediaDevices.enumerateDevices()).filter(e=>e.kind==="videoinput").map(e=>({id:e.deviceId,label:e.label}))}catch(e){throw console.log(e.name+":"+e.message),e}}function D(e,a,t){const l={audio:!1,video:{width:d.value,height:r.value,transform:"scaleX(-1)",deviceId:e}};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(l).then(a).catch(t):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(l,a,t):navigator.mozGetUserMedia?navigator.mozGetUserMedia(l,a,t):navigator.getUserMedia&&navigator.getUserMedia(l,a,t)}function U(e){D((a,t)=>{"srcObject"in n.value?n.value.srcObject=t:n.value.src=window.URL.createObjectURL(t),n.value.onloadedmetadata=l=>{n.value.play()}},a=>{console.log(`访问用户媒体设备失败${a.name}, ${a.message}`),alert("摄像头打开失败，请检查摄像头并点击浏览器地址栏右侧的摄像头标志进行开启设置")})}function b(){m.value.drawImage(n.value,0,0,300,200),c.value=o.value.toDataURL("image/png",.7)}return(e,a)=>{const t=y("el-button");return C(),M("div",null,[_,s("img",{id:"save_img",src:v(c),alt:""},null,8,j),s("canvas",{style:{display:"none"},id:"canvasCamera",width:v(d),height:v(r)},null,8,L),I(t,{onClick:b},{default:k(()=>[G("拍照")]),_:1})])}}});export{B as default};
