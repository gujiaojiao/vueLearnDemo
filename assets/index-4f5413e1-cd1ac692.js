import{J as q,I as Q,O as _,k as R,g as Z,G as A,o as u,y as b,a as V,W as e,i as s,Q as t,p as w,b as I,C as y,d as h,m as H,e as z,T as $,$ as J,F as O,X as K,L as f,z as M}from"./index-4eac733d.js";const Y=["onClick"],te=q({__name:"index",setup(ee){let g=Q(),v=_([]),o=_(0),a=R({attrName:"",categoryId:"",attrValueList:[],categoryLevel:3}),x=_([]);Z(()=>g.c3Id,()=>{v.value=[],g.c3Id&&C()});const C=async()=>{const{c1Id:l,c2Id:n,c3Id:p}=g;let r=await A(l,n,p);r.code==200&&(v.value=r.data)},U=()=>{Object.assign(a,{attrName:"",attrValueList:[],categoryId:g.c3Id,categoryLevel:3}),o.value=1},j=l=>{o.value=1,Object.assign(a,JSON.parse(JSON.stringify(l)))},N=()=>{o.value=0},D=()=>{a.attrValueList.push({valueName:"",flag:!0}),O(()=>{x.value[a.attrValueList.length-1].focus()})},F=async()=>{let l=await K(a);console.log(l),l.code==200?(o.value=0,f({type:"success",message:a.id?"修改成功":"添加成功"}),C()):f({type:"error",message:a.id?"修改失败":"添加失败"})},P=(l,n)=>{if(l.valueName.trim()==""){a.attrValueList.splice(n,1),f({type:"error",message:"属性值不能为空"});return}if(a.attrValueList.find(p=>{if(p!=l)return p.valueName===l.valueName})){a.attrValueList.splice(n,1),f({type:"error",message:"属性值不能重复"});return}l.flag=!1},S=(l,n)=>{l.flag=!0,O(()=>{x.value[n].focus()})},T=async l=>{(await M(l)).code==200?(f({type:"success",message:"删除成功"}),C()):f({type:"error",message:"删除失败"})};return(l,n)=>{const p=u("Category"),r=u("el-button"),c=u("el-table-column"),B=u("el-tag"),E=u("el-popconfirm"),k=u("el-table"),L=u("el-input"),G=u("el-form-item"),W=u("el-form"),X=u("el-card");return b(),V(h,null,[e(p,{scene:s(o)},null,8,["scene"]),e(X,{style:{margin:"10px 0px"}},{default:t(()=>[w(I("div",null,[e(r,{onClick:U,type:"primary",size:"default",icon:"Plus",disabled:!s(g).c3Id},{default:t(()=>[y(" 添加属性 ")]),_:1},8,["disabled"]),e(k,{border:"",style:{margin:"10px 0px"},data:s(v)},{default:t(()=>[e(c,{label:"序号",type:"index",align:"center",width:"80px"}),e(c,{label:"属性名称",width:"120px",prop:"attrName"}),e(c,{label:"属性值名称"},{default:t(({row:i,$index:m})=>[(b(!0),V(h,null,H(i.attrValueList,(d,ae)=>(b(),z(B,{style:{margin:"5px"},key:d.id},{default:t(()=>[y($(d.valueName),1)]),_:2},1024))),128))]),_:1}),e(c,{label:"操作",width:"120px"},{default:t(({row:i,$index:m})=>[e(r,{type:"primary",size:"small",icon:"Edit",onClick:d=>j(i)},null,8,["onClick"]),e(E,{title:`你确定删除${i.attrName}?`,width:"200px",onConfirm:d=>T(i.id)},{reference:t(()=>[e(r,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[J,s(o)==0]]),w(I("div",null,[e(W,{inline:!0},{default:t(()=>[e(G,{label:"属性名称"},{default:t(()=>[e(L,{placeholder:"请输入属性名称",modelValue:s(a).attrName,"onUpdate:modelValue":n[0]||(n[0]=i=>s(a).attrName=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{onClick:D,disabled:!s(a).attrName,type:"primary",size:"default",icon:"Plus"},{default:t(()=>[y(" 添加属性值 ")]),_:1},8,["disabled"]),e(r,{onClick:N,type:"primary",size:"default"},{default:t(()=>[y("取消")]),_:1}),e(k,{border:"",style:{margin:"10px 0px"},data:s(a).attrValueList},{default:t(()=>[e(c,{label:"序号",type:"index",align:"center",width:"80px"}),e(c,{label:"属性值名称"},{default:t(({row:i,$index:m})=>[i.flag?(b(),z(L,{key:0,ref:d=>s(x)[m]=d,onBlur:d=>P(i,m),size:"small",placeholder:"请你输入属性值名称",modelValue:i.valueName,"onUpdate:modelValue":d=>i.valueName=d},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(b(),V("div",{key:1,onClick:d=>S(i,m)},$(i.valueName),9,Y))]),_:1}),e(c,{label:"属性值操作"},{default:t(({row:i,index:m})=>[e(r,{type:"primary",size:"small",icon:"Delete",onClick:d=>s(a).attrValueList.splice(m,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(r,{type:"primary",size:"default",onClick:F,disabled:!(s(a).attrValueList.length>0)},{default:t(()=>[y(" 保存 ")]),_:1},8,["disabled"]),e(r,{onClick:N,type:"primary",size:"default"},{default:t(()=>[y("取消")]),_:1})],512),[[J,s(o)==1]])]),_:1})],64)}}});export{te as default};
