import{d as Q,N as R,r as N,b as G,s as H,c as u,o as _,e as x,f as e,g as o,w as s,y as A,z,h as I,j as m,F as B,m as K,n as O,t as S,v as h,O as W,M as f,P as X,Q as Y}from"./index-1d4d71cd.js";const Z=["onClick"],le=Q({__name:"index",setup(ee){let y=R(),v=N([]),d=N(0),a=G({attrName:"",categoryId:"",attrValueList:[],categoryLevel:3}),b=N([]);H(()=>y.c3Id,()=>{v.value=[],y.c3Id&&V()});const V=async()=>{const{c1Id:l,c2Id:t,c3Id:g}=y;let n=await Y(l,t,g);n.code==200&&(v.value=n.data)},$=()=>{Object.assign(a,{attrName:"",attrValueList:[],categoryId:y.c3Id,categoryLevel:3}),d.value=1},w=l=>{d.value=1,Object.assign(a,JSON.parse(JSON.stringify(l)))},k=()=>{d.value=0},D=()=>{a.attrValueList.push({valueName:"",flag:!0}),h(()=>{b.value[a.attrValueList.length-1].focus()})},E=async()=>{let l=await W(a);console.log(l),l.code==200?(d.value=0,f({type:"success",message:a.id?"修改成功":"添加成功"}),V()):f({type:"error",message:a.id?"修改失败":"添加失败"})},P=(l,t)=>{if(l.valueName.trim()==""){a.attrValueList.splice(t,1),f({type:"error",message:"属性值不能为空"});return}if(a.attrValueList.find(n=>{if(n!=l)return n.valueName===l.valueName})){a.attrValueList.splice(t,1),f({type:"error",message:"属性值不能重复"});return}l.flag=!1},U=(l,t)=>{l.flag=!0,h(()=>{b.value[t].focus()})},j=async l=>{(await X(l)).code==200?(f({type:"success",message:"删除成功"}),V()):f({type:"error",message:"删除失败"})};return(l,t)=>{const g=u("Category"),n=u("el-button"),c=u("el-table-column"),q=u("el-tag"),F=u("el-popconfirm"),C=u("el-table"),L=u("el-input"),J=u("el-form-item"),M=u("el-form"),T=u("el-card");return _(),x(B,null,[e(g,{scene:o(d)},null,8,["scene"]),e(T,{style:{margin:"10px 0px"}},{default:s(()=>[A(I("div",null,[e(n,{onClick:$,type:"primary",size:"default",icon:"Plus",disabled:!o(y).c3Id},{default:s(()=>[...t[1]||(t[1]=[m(" 添加属性 ",-1)])]),_:1},8,["disabled"]),e(C,{border:"",style:{margin:"10px 0px"},data:o(v)},{default:s(()=>[e(c,{label:"序号",type:"index",align:"center",width:"80px"}),e(c,{label:"属性名称",width:"120px",prop:"attrName"}),e(c,{label:"属性值名称"},{default:s(({row:r,$index:p})=>[(_(!0),x(B,null,K(r.attrValueList,(i,te)=>(_(),O(q,{style:{margin:"5px"},key:i.id},{default:s(()=>[m(S(i.valueName),1)]),_:2},1024))),128))]),_:1}),e(c,{label:"操作",width:"120px"},{default:s(({row:r,$index:p})=>[e(n,{type:"primary",size:"small",icon:"Edit",onClick:i=>w(r)},null,8,["onClick"]),e(F,{title:`你确定删除${r.attrName}?`,width:"200px",onConfirm:i=>j(r.id)},{reference:s(()=>[e(n,{type:"primary",size:"small",icon:"Delete"})]),_:1},8,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[z,o(d)==0]]),A(I("div",null,[e(M,{inline:!0},{default:s(()=>[e(J,{label:"属性名称"},{default:s(()=>[e(L,{placeholder:"请输入属性名称",modelValue:o(a).attrName,"onUpdate:modelValue":t[0]||(t[0]=r=>o(a).attrName=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{onClick:D,disabled:!o(a).attrName,type:"primary",size:"default",icon:"Plus"},{default:s(()=>[...t[2]||(t[2]=[m(" 添加属性值 ",-1)])]),_:1},8,["disabled"]),e(n,{onClick:k,type:"primary",size:"default"},{default:s(()=>[...t[3]||(t[3]=[m("取消",-1)])]),_:1}),e(C,{border:"",style:{margin:"10px 0px"},data:o(a).attrValueList},{default:s(()=>[e(c,{label:"序号",type:"index",align:"center",width:"80px"}),e(c,{label:"属性值名称"},{default:s(({row:r,$index:p})=>[r.flag?(_(),O(L,{key:0,ref:i=>o(b)[p]=i,onBlur:i=>P(r,p),size:"small",placeholder:"请你输入属性值名称",modelValue:r.valueName,"onUpdate:modelValue":i=>r.valueName=i},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(_(),x("div",{key:1,onClick:i=>U(r,p)},S(r.valueName),9,Z))]),_:1}),e(c,{label:"属性值操作"},{default:s(({row:r,index:p})=>[e(n,{type:"primary",size:"small",icon:"Delete",onClick:i=>o(a).attrValueList.splice(p,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(n,{type:"primary",size:"default",onClick:E,disabled:!(o(a).attrValueList.length>0)},{default:s(()=>[...t[4]||(t[4]=[m(" 保存 ",-1)])]),_:1},8,["disabled"]),e(n,{onClick:k,type:"primary",size:"default"},{default:s(()=>[...t[5]||(t[5]=[m("取消",-1)])]),_:1})],512),[[z,o(d)==1]])]),_:1})],64)}}});export{le as default};
