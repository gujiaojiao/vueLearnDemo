import{d as D,r as i,D as w,c as U,o as b,e as M,k as c,g as s,f as y,w as k,i as x}from"./index-1266dafb.js";const I=c("video",{id:"videoCamera",autoplay:""},null,-1),L=["src"],B=["width","height"],j=D({__name:"index",setup(G){let d=i(300),v=i(200),r=i(),u=i();const m=i([{id:"",label:"摄像头1"}]),l=i(null),g=i(null),n=i(null);w(()=>{f().then(a=>{a.length&&(m.value=a),r.value=m.value[0].id,h()})});function h(){l.value=document.getElementById("canvasCamera"),g.value=l.value.getContext("2d"),n.value=document.getElementById("videoCamera"),p(r.value)}async function f(){console.log("1111",navigator.mediaDevices),(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)&&(alert("不支持 mediaDevices.enumerateDevices()"),console.log("设备不支持 "));try{return(await navigator.mediaDevices.enumerateDevices()).filter(e=>e.kind==="videoinput").map(e=>({id:e.deviceId,label:e.label}))}catch(a){throw console.log(a.name+":"+a.message),a}}function _(a,t,e){const o={audio:!1,video:{width:d.value,height:v.value,transform:"scaleX(-1)",deviceId:a}};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(o).then(t).catch(e):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(o,t,e):navigator.mozGetUserMedia?navigator.mozGetUserMedia(o,t,e):navigator.getUserMedia&&navigator.getUserMedia(o,t,e)}function p(a){_((t,e)=>{"srcObject"in n.value?n.value.srcObject=e:n.value.src=window.URL.createObjectURL(e),n.value.onloadedmetadata=o=>{n.value.play()}},t=>{console.log(`访问用户媒体设备失败${t.name}, ${t.message}`),alert("摄像头打开失败，请检查摄像头并点击浏览器地址栏右侧的摄像头标志进行开启设置")})}function C(){g.value.drawImage(n.value,0,0,300,200),u.value=l.value.toDataURL("image/png",.7)}return(a,t)=>{const e=U("el-button");return b(),M("div",null,[I,c("img",{id:"save_img",src:s(u),alt:""},null,8,L),c("canvas",{style:{display:"none"},id:"canvasCamera",width:s(d),height:s(v)},null,8,B),y(e,{onClick:C},{default:k(()=>[x("拍照")]),_:1})])}}});export{j as default};
