import{d as w,r as i,B as D,c as U,o as b,e as M,h as s,g as d,f as y,w as x,j as k}from"./index-1d4d71cd.js";const B=["src"],I=["width","height"],G=w({__name:"index",setup(L){let c=i(300),v=i(200),r=i(),u=i();const m=i([{id:"",label:"摄像头1"}]),l=i(null),g=i(null),n=i(null);D(()=>{f().then(t=>{t.length&&(m.value=t),r.value=m.value[0].id,h()})});function h(){l.value=document.getElementById("canvasCamera"),g.value=l.value.getContext("2d"),n.value=document.getElementById("videoCamera"),C(r.value)}async function f(){console.log("1111",navigator.mediaDevices),(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)&&(alert("不支持 mediaDevices.enumerateDevices()"),console.log("设备不支持 "));try{return(await navigator.mediaDevices.enumerateDevices()).filter(a=>a.kind==="videoinput").map(a=>({id:a.deviceId,label:a.label}))}catch(t){throw console.log(t.name+":"+t.message),t}}function p(t,e,a){const o={audio:!1,video:{width:c.value,height:v.value,transform:"scaleX(-1)",deviceId:t}};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(o).then(e).catch(a):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(o,e,a):navigator.mozGetUserMedia?navigator.mozGetUserMedia(o,e,a):navigator.getUserMedia&&navigator.getUserMedia(o,e,a)}function C(t){p((e,a)=>{"srcObject"in n.value?n.value.srcObject=a:n.value.src=window.URL.createObjectURL(a),n.value.onloadedmetadata=o=>{n.value.play()}},e=>{console.log(`访问用户媒体设备失败${e.name}, ${e.message}`),alert("摄像头打开失败，请检查摄像头并点击浏览器地址栏右侧的摄像头标志进行开启设置")})}function _(){g.value.drawImage(n.value,0,0,300,200),u.value=l.value.toDataURL("image/png",.7)}return(t,e)=>{const a=U("el-button");return b(),M("div",null,[e[1]||(e[1]=s("video",{id:"videoCamera",autoplay:""},null,-1)),s("img",{id:"save_img",src:d(u),alt:""},null,8,B),s("canvas",{style:{display:"none"},id:"canvasCamera",width:d(c),height:d(v)},null,8,I),y(a,{onClick:_},{default:x(()=>[...e[0]||(e[0]=[k("拍照",-1)])]),_:1})])}}});export{G as default};
